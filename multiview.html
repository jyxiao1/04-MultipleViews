<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v5.min.js"></script>
    <script src="https://airve.github.io/js/verge/verge.js"></script>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>

    <style type="text/css">
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }

        .area {
            fill: lightsteelblue;
        }

        path:hover {
            fill-opacity: .6;
        }
    </style>
</head>
<body onload="sizeChange()">

<div id="maps"></div>
<div id="areaGraphs"></div>

<script type="text/javascript">
    var margin = {top: 0, right: 0, bottom: 0, left: 0},
        width = screen.width;
        //width = verge.viewportW() - margin.left - margin.right - 20,
        height = verge.viewportH() - margin.top - margin.bottom;

    d3.select(window)
        .on("resize", sizeChange);





    d3.json("us-states.json").then(function(allStates) {

        //slight alteration of coordinates
        for (var i = 0; i < allStates.features.length; i++) {
            var coords = allStates.features[i].geometry.coordinates;

            //applying the transformation to hawaii or alaska breaks it due to how albersUsa functions
            if (allStates.features[i].properties.name !== "Hawaii" && allStates.features[i].properties.name !== "Alaska")
                if (coords.length > 1) {
                    for (var j = 0; j < coords.length; j++) {
                        for (var k = 0; k < coords[j][0].length; k++) {
                            coords[j][0][k][0] -= 2.0;
                            coords[j][0][k][1] -= 1.0;
                        }
                    }
                } else {
                    for (k = 0; k < coords[0].length; k++) {
                        coords[0][k][0] -= 2.0;
                        coords[0][k][1] -= 1.0;
                    }
                }
        }

        function drawStates(selectedYears) {
                var mapSuicidalThoughts = d3.select("#maps")
                    .call(function ()
                    {
                        var currSvg = document.getElementById("mapSuicidalThoughts");
                        if (currSvg) //if the current svg exists, get rid of it
                            currSvg.remove();
                    })
                    .append("svg")
                    .attr("id", "mapSuicidalThoughts")
                    .attr("width", "50%")
                    .append("g")
                    .attr("class", "scalable");

                var mapSuicides = d3.select("#maps")
                    .call(function ()
                    {
                        var currSvg = document.getElementById("mapSuicides");
                        if (currSvg) //if the current svg exists, get rid of it
                            currSvg.remove();
                    })
                    .append("svg")
                    .attr("id", "mapSuicides")
                    .attr("width", "50%")
                    .append("g")
                    .attr("class", "scalable");

                // var suicidalThoughtsTitle

                var suicidalThoughtsTitle = mapSuicidalThoughts.append("g")
                    .append("text")
                    .text("Average Annual Percentage of the Population who had a Major Depressive Episode ( " + selectedYears[0] + " - " + selectedYears[selectedYears.length - 1] +" )")
                    .attr("x", 50)
                    .attr("dy", "1.2em")
                    .style("text-anchor", "left")
                    .attr("pointer-events", "none")
                    .attr("font-size", "20px")
                    .attr("font-weight", "bold");

                console.log(width*.25);

                var suicidesTitle = mapSuicides.append("g")
                    .append("text")
                    .text("Average Annual Percentage of the Population who dies to Suicide ( " + selectedYears[0] + " - " + selectedYears[selectedYears.length - 1] +" )")
                    .attr("x", 50)
                    .attr("dy", "1.2em")
                    .style("text-anchor", "left")
                    .attr("pointer-events", "none")
                    .attr("font-size", "20px")
                    .attr("font-weight", "bold");

                var usMap = d3.geoAlbersUsa()
                    .scale(1175)
                    .translate([480, 285]);

                // Define path generator
                var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
                    .projection(usMap);  // tell path generator to use albersUsa projection

                //map ratio is 1.92 to 1

                //suicide data for both genders by state, year, and age group
                d3.csv("suiboth.csv").then(function(suiboth_data) {



                    for (i = 0; i < suiboth_data.length; i++) {

                        // Grab State Name
                        var dataState = suiboth_data[i].State;
                        // Grab data value
                        var dataYear = suiboth_data[i].Year;
                        var dataDeaths = suiboth_data[i].Deaths;
                        var dataPopulation = suiboth_data[i].Population;

                        //if there are no deaths
                        if (dataDeaths === "P") {
                            continue;
                        }

                        for (var l = 0; l < allStates.features.length; l++) {
                            var jsonState = allStates.features[l].properties.name;

                            //Search for state
                            if (jsonState === dataState) {
                                for (k = 0; k < selectedYears.length; k++) {
                                    if (selectedYears[k] === dataYear) {
                                        if (!allStates.features[l].properties.hasOwnProperty("deaths")) {
                                            allStates.features[l].properties.deaths = parseInt(dataDeaths);
                                        } else {
                                            allStates.features[l].properties.deaths += parseInt(dataDeaths);
                                        }
                                        if (!allStates.features[l].properties.hasOwnProperty("population")) {
                                            allStates.features[l].properties.population = parseInt(dataPopulation);
                                        } else {
                                            allStates.features[l].properties.population += parseInt(dataPopulation);
                                        }
                                        break;
                                    }
                                }
                            }
                        }
                    } //iteration through suicide data

                    var lowestVal = allStates.features[0].properties.deaths / allStates.features[0].properties.population;
                    var highestVal = lowestVal;

                    //Iterate through the states looking for the lowest and highest value
                    for (i = 0; i < allStates.features.length; i++) {
                        var percentage = allStates.features[i].properties.deaths / allStates.features[i].properties.population;
                        if (percentage < lowestVal) {
                            lowestVal = percentage;
                        }
                        if (percentage > highestVal) {
                            highestVal = percentage;
                        }
                    }

                    console.log(lowestVal);
                    console.log(highestVal);

                    // Define linear scale for output
                    var color = d3.scaleLinear()
                    //lab(20.00, -80.00, 70.00) to lab(20.00, 80.00, 70)
                    //cream to dark blue
                        .interpolate(d3.interpolateLab)
                        .domain([lowestVal, highestVal])
                        .range(["hsl(162,100%,70%)", "hsl(222,30%,20%)"]);

                    mapSuicides.selectAll("path")
                        .data(allStates.features)
                        .enter()
                        .append("path")
                        .attr("d", path)
                        .style("stroke", "#ffffff")
                        .style("stroke-width", "2")
                        .style("fill", function (d) {

                            var value = d.properties.deaths / d.properties.population;
                            if (value) {
                                //If value exists…
                                return color(value);
                            } else {
                                //If value is undefined…
                                return "rgb(213,222,217)";
                            }
                        })
                        .on("mouseover", function (d) {
                            tooltipSuicides.style("display", null);
                        })
                        .on("mouseout", function (d) {
                            tooltipSuicides.style("display", "none");
                        })
                        .on("mousemove", function (d) {
                            var xPosition = d3.mouse(this)[0] - 25;
                            var yPosition = d3.mouse(this)[1] - 70;

                            //if the mouse would be too far right, move the tooltip to the left
                            if (xPosition > width * 0.3) {
                                xPosition -= 150;
                            }
                            tooltipSuicides.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
                            tooltipSuicides
                                .select("#state")
                                .text(d.properties.name + ":");
                            tooltipSuicides
                                .select("#allPercent")
                                .text("Average number of deaths: "
                                    + d.properties.deaths);
                            tooltipSuicides
                                .select("#youngPercent")
                                .text("Average population: "
                                    + d.properties.population);
                            tooltipSuicides
                                .select("#oldPercent")
                                .text("Average percentage: "
                                    + (d.properties.deaths / d.properties.population).toFixed(5)
                                    + "%");

                        });

                    var tooltipSuicides = mapSuicides.append("g")
                        .attr("class", "tooltip")
                        .style("display", "none");

                    tooltipSuicides.append("rect")
                        .attr("width", 215)
                        .attr("height", 75)
                        .attr("fill", "white")
                        .attr("pointer-events", "none")
                        .style("opacity", 0.5);

                    tooltipSuicides.append("text")
                        .attr("id", "state")
                        .attr("x", 5)
                        .attr("dy", "1.2em")
                        .style("text-anchor", "left")
                        .attr("pointer-events", "none")
                        .attr("font-size", "16px")
                        .attr("font-weight", "bold");


                    tooltipSuicides.append("text")
                        .attr("id", "allPercent")
                        .attr("x", 5)
                        .attr("dy", "2.5em")
                        .style("text-anchor", "left")
                        .attr("pointer-events", "none")
                        .attr("font-size", "14px");

                    tooltipSuicides.append("text")
                        .attr("id", "youngPercent")
                        .attr("x", 5)
                        .attr("dy", "3.6em")
                        .style("text-anchor", "left")
                        .attr("pointer-events", "none")
                        .attr("font-size", "14px");

                    tooltipSuicides.append("text")
                        .attr("id", "oldPercent")
                        .attr("x", 5)
                        .attr("dy", "4.7em")
                        .style("text-anchor", "left")
                        .attr("pointer-events", "none")
                        .attr("font-size", "14px");
                    });
                d3.csv("NSDUHsaeExcelTab25-2014.csv").then(function (dat2014) {
                    d3.csv("NSDUHsaeExcelTab14-2015.csv").then(function (dat2015) {
                        d3.csv("NSDUHsaeExcelTab29-2016.csv").then(function (dat2016) {
                            d3.csv("NSDUHsaeExcelTab31-2017.csv").then(function (dat2017) {
                                for (k = 0; k < selectedYears.length; k++) {
                                    if (selectedYears[k] === "2014") {
                                        for (i = 0; i < dat2014.length; i++) {
                                            var dataState = dat2014[i].State;
                                            var allPercent = dat2014[i]["18 or Older Estimate"];
                                            var youngPercent = dat2014[i]["18-25 Estimate"];
                                            var oldPercent = dat2014[i]["26 or Older Estimate"];

                                            for (var l = 0; l < allStates.features.length; l++) {
                                                var jsonState = allStates.features[l].properties.name;
                                                if (!allStates.features[l].properties.hasOwnProperty("suicidalThoughts")) {
                                                    allStates.features[l].properties.suicidalThoughts = [];
                                                }
                                                //Search for state
                                                if (jsonState === dataState) {
                                                    allStates.features[l].properties.suicidalThoughts.push(["2014", parseFloat(allPercent), parseFloat(youngPercent), parseFloat(oldPercent)]);
                                                }
                                            }
                                        }
                                    } else if (selectedYears[k] === "2015") {
                                        for (i = 0; i < dat2015.length; i++) {
                                            dataState = dat2015[i].State;
                                            allPercent = dat2015[i]["18 or Older Estimate"];
                                            youngPercent = dat2015[i]["18-25 Estimate"];
                                            oldPercent = dat2015[i]["26 or Older Estimate"];

                                            for (l = 0; l < allStates.features.length; l++) {
                                                jsonState = allStates.features[l].properties.name;
                                                if (!allStates.features[l].properties.hasOwnProperty("suicidalThoughts")) {
                                                    allStates.features[l].properties.suicidalThoughts = [];
                                                }
                                                //Search for state
                                                if (jsonState === dataState) {
                                                    allStates.features[l].properties.suicidalThoughts.push(["2015", parseFloat(allPercent), parseFloat(youngPercent), parseFloat(oldPercent)]);
                                                }
                                            }
                                        }
                                    } else if (selectedYears[k] === "2016") {
                                        for (i = 0; i < dat2016.length; i++) {
                                            dataState = dat2016[i].State;
                                            allPercent = dat2016[i]["18 or Older Estimate"];
                                            youngPercent = dat2016[i]["18-25 Estimate"];
                                            oldPercent = dat2016[i]["26 or Older Estimate"];

                                            for (l = 0; l < allStates.features.length; l++) {
                                                jsonState = allStates.features[l].properties.name;
                                                if (!allStates.features[l].properties.hasOwnProperty("suicidalThoughts")) {
                                                    allStates.features[l].properties.suicidalThoughts = [];
                                                }
                                                //Search for state
                                                if (jsonState === dataState) {
                                                    allStates.features[l].properties.suicidalThoughts.push(["2016", parseFloat(allPercent), parseFloat(youngPercent), parseFloat(oldPercent)]);
                                                }
                                            }
                                        }
                                    } else if (selectedYears[k] === "2017") {
                                        for (i = 0; i < dat2017.length; i++) {
                                            dataState = dat2017[i].State;
                                            allPercent = dat2017[i]["18 or Older Estimate"];
                                            youngPercent = dat2017[i]["18-25 Estimate"];
                                            oldPercent = dat2017[i]["26 or Older Estimate"];

                                            for (l = 0; l < allStates.features.length; l++) {
                                                jsonState = allStates.features[l].properties.name;
                                                if (!allStates.features[l].properties.hasOwnProperty("suicidalThoughts")) {
                                                    allStates.features[l].properties.suicidalThoughts = [];
                                                }
                                                //Search for state
                                                if (jsonState === dataState) {
                                                    allStates.features[l].properties.suicidalThoughts.push(["2017", parseFloat(allPercent), parseFloat(youngPercent), parseFloat(oldPercent)]);
                                                }
                                            }
                                        }
                                    }
                                }
                                lowestVal = 100;
                                highestVal = 0;

                                //Iterate through the states looking for the lowest and highest value
                                for (i = 0; i < allStates.features.length; i++) {
                                    allPercent = 0;
                                    youngPercent = 0;
                                    oldPercent = 0;
                                    var numYears = allStates.features[i].properties.suicidalThoughts.length;

                                    for (j = 0; j < numYears; j++) {
                                        allPercent += allStates.features[i].properties.suicidalThoughts[j][1];
                                        youngPercent += allStates.features[i].properties.suicidalThoughts[j][2];
                                        oldPercent += allStates.features[i].properties.suicidalThoughts[j][3];
                                    }
                                    allPercent /= numYears;
                                    youngPercent /= numYears;
                                    oldPercent /= numYears;
                                    allStates.features[i].properties.suicidalThoughts.allPercentage = allPercent;
                                    allStates.features[i].properties.suicidalThoughts.youngPercentage = youngPercent;
                                    allStates.features[i].properties.suicidalThoughts.oldPercentage = oldPercent;

                                    if (allPercent < lowestVal) {
                                        lowestVal = allPercent;
                                    }
                                    if (allPercent > highestVal) {
                                        highestVal = allPercent;
                                    }
                                }
                                console.log(highestVal);
                                console.log(lowestVal);

                                var color = d3.scaleLinear()
                                    .interpolate(d3.interpolateLab)
                                    .domain([lowestVal, highestVal])
                                    .range(["hsl(0,100%,70%)", "hsl(0,30%,20%)"]);

                                console.log(allStates.features);

                                mapSuicidalThoughts.selectAll("path")
                                    .data(allStates.features)
                                    .enter()
                                    .append("path")
                                    .attr("d", path)
                                    .style("stroke", "#ffffff")
                                    .style("stroke-width", "2")
                                    .style("fill", function (d) {
                                        var value = d.properties.suicidalThoughts.allPercentage;
                                        //check if the value exists
                                        if (value) {
                                            return color(value);
                                        } else {
                                            return "hsl(147,12%,85%)";
                                        }
                                    })
                                    .on("mouseover", function (d) {
                                        tooltipSuicidalThoughts.style("display", null);
                                    })
                                    .on("mouseout", function (d) {
                                        tooltipSuicidalThoughts.style("display", "none");
                                    })
                                    .on("mousemove", function (d) {
                                        var xPosition = d3.mouse(this)[0] - 25;
                                        var yPosition = d3.mouse(this)[1] - 70;

                                        //if the mouse would be too far right, move the tooltip to the left
                                        if (xPosition > width * 0.3) {
                                            xPosition -= 150;
                                        }
                                        tooltipSuicidalThoughts.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
                                        tooltipSuicidalThoughts
                                            .select("#state")
                                            .text(d.properties.name + ":");
                                        tooltipSuicidalThoughts
                                            .select("#allPercent")
                                            .text("18+ Suicidal Thoughts: "
                                                + d.properties.suicidalThoughts.allPercentage.toFixed(2)
                                                + "%");
                                        tooltipSuicidalThoughts
                                            .select("#youngPercent")
                                            .text("18-25 Suicidal Thoughts: "
                                                + d.properties.suicidalThoughts.youngPercentage.toFixed(2)
                                                + "%");
                                        tooltipSuicidalThoughts
                                            .select("#oldPercent")
                                            .text("25+ Suicidal Thoughts: "
                                                + d.properties.suicidalThoughts.oldPercentage.toFixed(2)
                                                + "%");

                                    });

                                var tooltipSuicidalThoughts = mapSuicidalThoughts.append("g")
                                    .attr("class", "tooltip")
                                    .style("display", "none");

                                tooltipSuicidalThoughts.append("rect")
                                    .attr("width", 215)
                                    .attr("height", 75)
                                    .attr("fill", "white")
                                    .attr("pointer-events", "none")
                                    .style("opacity", 0.5);

                                tooltipSuicidalThoughts.append("text")
                                    .attr("id", "state")
                                    .attr("x", 5)
                                    .attr("dy", "1.2em")
                                    .style("text-anchor", "left")
                                    .attr("pointer-events", "none")
                                    .attr("font-size", "16px")
                                    .attr("font-weight", "bold");


                                tooltipSuicidalThoughts.append("text")
                                    .attr("id", "allPercent")
                                    .attr("x", 5)
                                    .attr("dy", "2.5em")
                                    .style("text-anchor", "left")
                                    .attr("pointer-events", "none")
                                    .attr("font-size", "14px");

                                tooltipSuicidalThoughts.append("text")
                                    .attr("id", "youngPercent")
                                    .attr("x", 5)
                                    .attr("dy", "3.6em")
                                    .style("text-anchor", "left")
                                    .attr("pointer-events", "none")
                                    .attr("font-size", "14px");

                                tooltipSuicidalThoughts.append("text")
                                    .attr("id", "oldPercent")
                                    .attr("x", 5)
                                    .attr("dy", "4.7em")
                                    .style("text-anchor", "left")
                                    .attr("pointer-events", "none")
                                    .attr("font-size", "14px");

                                var interpolateLab = [
                                    {name: "Lab", interpolate: d3.interpolateLab},
                                ];

                                var y = d3.scaleOrdinal()
                                    .domain(interpolateLab.map(function (d) {
                                        return d.name;
                                    }))
                                    .range([0, 500]);

                                // var legendColor = color.domain([0, (width - 20) / 2]);
                                //code from https://bl.ocks.org/mbostock/3014589
                                var space = d3.select("body")//.selectAll(".space")
                                    .data(interpolateLab)
                                    .enter().append("div")
                                    .attr("class", "space")
                                    .style("width", (width - 20) / 2 + "px")
                                    .style("height", 30 + "px")
                                    .style("left", margin + "px")
                                    .style("top", function (d, i) {
                                        return y(d.name) + "px";
                                    });

                                space.append("canvas")
                                    .data(interpolateLab)
                                    .attr("y", 500)
                                    .attr("width", (width - 20) / 2)
                                    .attr("height", 1)
                                    .style("width", (width - 20) / 2 + "px")
                                    .style("height", height + "px")
                                    .each(render);

                                function render(d) {
                                    var context = this.getContext("2d"),
                                        image = context.createImageData(width, 1);
                                    color.interpolate(d.interpolate);
                                    for (var i = 0, j = -1, c; i < width; ++i) {
                                        c = d3.rgb(color(i));
                                        image.data[++j] = c.r;
                                        image.data[++j] = c.g;
                                        image.data[++j] = c.b;
                                        image.data[++j] = 255;
                                    }
                                    context.putImageData(image, 0, 0);
                                }

                            });
                        });
                    });
                });
                sizeChange();
            }
            drawStates(["1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009",
            "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017"]);


            //suicide attempt data starting from 2008 (it was recorded differently before
            //this data uses surveys from each US district so it should be representative of the population as a whole
                d3.csv("NSDUH_suidata_2008_to_2017.csv").then(function(suidata) {
                    var mainAreaChartHeight = 200;

                    //data aggregation
                    var suiThink = d3.nest()
                        .key(function (d) {
                            return d.Year;
                        })
                        .key(function (d) {
                            return d.SUICTHNK;
                        })
                        .rollup(function (v) {
                            return v.length;
                        })
                        .entries(suidata);

                    var suiPlan = d3.nest()
                        .key(function (d) {
                            return d.Year;
                        })
                        .key(function (d) {
                            return d.SUICPLAN;
                        })
                        .rollup(function (v) {
                            return v.length;
                        })
                        .entries(suidata);

                    var suiTry = d3.nest()
                        .key(function (d) {
                            return d.Year;
                        })
                        .key(function (d) {
                            return d.SUICTRY;
                        })
                        .rollup(function (v) {
                            return v.length;
                        })
                        .entries(suidata);

                    var numYes;
                    var numNo;
                    for (i = 0; i <suiThink.length; i++){
                        for (var p = 0; p < suiThink[i].values.length; p++) {
                            var curr = suiThink[i].values[p];
                            if (curr.key === "1") {
                                numYes = parseInt(curr.value);
                            } else if (curr.key === "2") {
                                numNo = parseInt(curr.value);
                            }
                        }
                        suiThink[i].percent = numYes/(numNo + numYes);
                    }

                    for (i = 0; i <suiPlan.length; i++){
                        for (p = 0; p < suiPlan[i].values.length; p++) {
                            curr = suiPlan[i].values[p];
                            if (curr.key === "1") {
                                numYes = parseInt(curr.value);
                            } else if (curr.key === "2") {
                                numNo = parseInt(curr.value);
                            }
                        }
                        suiPlan[i].percentFromFirst = numYes/(numNo + numYes);
                        suiPlan[i].percent = numYes/(numNo + numYes)*suiThink[i].percent;
                    }
                    for (i = 0; i <suiTry.length; i++){
                        for (p = 0; p < suiTry[i].values.length; p++) {
                            curr = suiTry[i].values[p];
                            if (curr.key === "1") {
                                numYes = parseInt(curr.value);
                            } else if (curr.key === "2") {
                                numNo = parseInt(curr.value);
                            }
                        }
                        suiTry[i].percentFromFirst = numYes/(numNo + numYes);
                        suiTry[i].percent = numYes/(numNo + numYes)*suiThink[i].percent;
                    }

                    var x = d3.scaleLinear().range([80, width/2 - 80]);
                    var y = d3.scaleLinear().range([mainAreaChartHeight - 20, 0]);

                    console.log(d3.extent(suiThink, function(d) { return parseInt(d.key); }));

                    x.domain([1999,2017]);//d3.extent(suiThink, function(d) { return parseInt(d.key); }));
                    console.log(x(parseInt(suiThink[0].key)));
                    //shows the change in rate up to 10%
                    y.domain([0, .10]);

                    var suicidalPercentArea = d3.area()
                        .x(function(d) { return x(parseInt(d.key)); })
                        .y0(mainAreaChartHeight - 20)
                        .y1(function(d) { return y(d.percent); });

                    var suicidalPercentCurve = d3.line()
                        .x(function(d) { return x(parseInt(d.key)); })
                        .y(function(d) { return y(d.percent); });

                    var step = 1;

                    var suiThinkSvg = d3.select("#areaGraphs").append("svg")
                        .attr("class", "graphContainer")
                        .attr("width", "50%")
                        .attr("height", mainAreaChartHeight + margin.top + margin.bottom)
                        .append("g")
                        .attr("class", "scalable");

                    var slider = suiThinkSvg.append('g')
                        .attr("class", "slide")
                        .attr('transform', 'translate(' + 10 +', '+ 190 + ')');

                    var xScale = d3.scaleLinear()
                        .domain([1999,2017])
                        .range([80, width/2 - 80])
                        .clamp(true);

                    var reverseXScale = d3.scaleLinear()
                        .domain([80, width/2 - 80])
                        .range([1999,2017])
                        .clamp(true);

                    suiThinkSvg.append("path")
                        .data([suiThink])
                        .attr("class", "area")
                        .attr("d", suicidalPercentArea)
                        .attr("transform", "translate(0," + 10 + ")");

                    suiThinkSvg.append("path")
                        .data([suiThink])
                        .attr("class", "line")
                        .attr("d", suicidalPercentCurve)
                        .attr("transform", "translate(0," + 10 + ")");


                    suiThinkSvg.append("g")
                        .attr("class", "xaxis")
                        .attr("transform", "translate(0," + 190 + ")")
                        .call(d3.axisBottom(x));

                    suiThinkSvg.append("text")
                        .text("Percent of people who had thoughts of suicide")
                        .style("text-anchor", "middle")
                        .attr("dy", 225)
                        .attr("dx", width/4);

                    suiThinkSvg.append("g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(80, 10)")
                        .call(d3.axisLeft(y));

                    suiThinkSvg.append("rect")
                        .attr("class", "middleArea")
                        .attr("x", xScale(1999))
                        .attr("y", 10)
                        .attr("width", xScale(2017) - xScale(1999))
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .style("opacity", 0.5);

                    suiThinkSvg.append("rect")
                        .attr("class", "leftLine")
                        .attr("x", xScale(1999) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                            var currPos = d3.event.x;
                            currPos = Math.round(reverseXScale(currPos));
                            var rightPos = Math.round(reverseXScale(d3.select(".rightLine").attr("x")));

                            if(currPos !== Math.round(reverseXScale(d3.select(".leftLine").attr("x")))
                                && currPos >= 1999 && currPos <= 2017
                                && rightPos >= currPos)
                                {
                                    d3.selectAll(".leftLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(rightPos) - xScale(currPos))
                                        .attr("x", xScale(currPos));
                                    var selectedYears = [];
                                    for(var i = currPos; i <= rightPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);
                                }
                            })
                         );

                    suiThinkSvg.append("rect")
                        .attr("class", "rightLine")
                        .attr("x", xScale(2017) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                                var currPos = d3.event.x;
                                currPos = Math.round(reverseXScale(currPos));
                                var leftPos = Math.round(reverseXScale(d3.select(".leftLine").attr("x")));
                                if(currPos !== Math.round(reverseXScale(d3.select(".rightLine").attr("x")))
                                    && currPos >= 2008 && currPos <= 2017
                                    && leftPos <= currPos)
                                {
                                    d3.selectAll(".rightLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(currPos) - xScale(leftPos));
                                    var selectedYears = [];
                                    for(var i = leftPos; i <= currPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);

                                }
                            })
                        );


                    var suiPlanSvg = d3.select("#areaGraphs").append("svg")
                        .attr("class", "graphContainer")
                        .attr("width", "50%")
                        .attr("height", mainAreaChartHeight + margin.top + margin.bottom)
                        .append("g")
                        .attr("class", "scalable");


                    suiPlanSvg.append("path")
                        .data([suiPlan])
                        .attr("class", "area")
                        .attr("d", suicidalPercentArea)
                        .attr("transform", "translate(0," + 10 + ")");

                    suiPlanSvg.append("path")
                        .data([suiPlan])
                        .attr("class", "line")
                        .attr("d", suicidalPercentCurve)
                        .attr("transform", "translate(0," + 10 + ")");


                    suiPlanSvg.append("g")
                        .attr("class", "xaxis")
                        .attr("transform", "translate(0," + 190 + ")")
                        .call(d3.axisBottom(x));

                    suiPlanSvg.append("text")
                        .text("Percent of people who made plans to commit suicide ")
                        .style("text-anchor", "middle")
                        .attr("dy", 225)
                        .attr("dx", width/4);

                    suiPlanSvg.append("g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(80,10 )")
                        .call(d3.axisLeft(y));

                    suiPlanSvg.append("rect")
                        .attr("class", "middleArea")
                        .attr("x", xScale(1999))
                        .attr("y", 10)
                        .attr("width", xScale(2017) - xScale(1999))
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .style("opacity", 0.5);

                    suiPlanSvg.append("rect")
                        .attr("class", "leftLine")
                        .attr("x", xScale(1999) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                                var currPos = d3.event.x;
                                currPos = Math.round(reverseXScale(currPos));
                                var rightPos = Math.round(reverseXScale(d3.select(".rightLine").attr("x")));

                                if(currPos !== Math.round(reverseXScale(d3.select(".leftLine").attr("x")))
                                    && currPos >= 1999 && currPos <= 2017
                                    && rightPos >= currPos)
                                {
                                    d3.selectAll(".leftLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(rightPos) - xScale(currPos))
                                        .attr("x", xScale(currPos));
                                    var selectedYears = [];
                                    for(var i = currPos; i <= rightPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);
                                }
                            })
                        );

                    suiPlanSvg.append("rect")
                        .attr("class", "rightLine")
                        .attr("x", xScale(2017) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                                var currPos = d3.event.x;
                                currPos = Math.round(reverseXScale(currPos));
                                var leftPos = Math.round(reverseXScale(d3.select(".leftLine").attr("x")));
                                if(currPos !== Math.round(reverseXScale(d3.select(".rightLine").attr("x")))
                                    && currPos >= 2008 && currPos <= 2017
                                    && leftPos <= currPos)
                                {
                                    d3.selectAll(".rightLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(currPos) - xScale(leftPos));
                                    var selectedYears = [];
                                    for(var i = leftPos; i <= currPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);
                                }
                            })
                        );

                    var suiTrySvg = d3.select("#areaGraphs").append("svg")
                        .attr("class", "graphContainer")
                        .attr("width", "50%")
                        .attr("height", mainAreaChartHeight + margin.top + margin.bottom)
                        .append("g")
                        .attr("class", "scalable");


                    suiTrySvg.append("path")
                        .data([suiTry])
                        .attr("class", "area")
                        .attr("d", suicidalPercentArea)
                        .attr("transform", "translate(0," + 10 + ")");

                    suiTrySvg.append("path")
                        .data([suiTry])
                        .attr("class", "line")
                        .attr("d", suicidalPercentCurve)
                        .attr("transform", "translate(0," + 10 + ")");


                    suiTrySvg.append("g")
                        .attr("class", "xaxis")
                        .attr("transform", "translate(0," + 190 + ")")
                        .call(d3.axisBottom(x));

                    suiTrySvg.append("text")
                        .text("Percent of people who attempted suicide ")
                        .style("text-anchor", "middle")
                        .attr("dy", 225)
                        .attr("dx", width/4);

                    suiTrySvg.append("g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(80, 10)")
                        .call(d3.axisLeft(y));

                    suiTrySvg.append("rect")
                        .attr("class", "middleArea")
                        .attr("x", xScale(1999))
                        .attr("y", 10)
                        .attr("width", xScale(2017) - xScale(1999))
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .style("opacity", 0.5);

                    suiTrySvg.append("rect")
                        .attr("class", "leftLine")
                        .attr("x", xScale(1999) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                                var currPos = d3.event.x;
                                currPos = Math.round(reverseXScale(currPos));
                                var rightPos = Math.round(reverseXScale(d3.select(".rightLine").attr("x")));

                                if(currPos !== Math.round(reverseXScale(d3.select(".leftLine").attr("x")))
                                    && currPos >= 1999 && currPos <= 2017
                                    && rightPos >= currPos)
                                {
                                    d3.selectAll(".leftLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(rightPos) - xScale(currPos))
                                        .attr("x", xScale(currPos));
                                    var selectedYears = [];
                                    for(var i = currPos; i <= rightPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);
                                }
                            })
                        );

                    suiTrySvg.append("rect")
                        .attr("class", "rightLine")
                        .attr("x", xScale(2017) - 5)
                        .attr("y", 10)
                        .attr("width", 10)
                        .attr("height", mainAreaChartHeight - 20)
                        .attr("fill", "hsl(222,30%,20%)")
                        .call(d3.drag()
                            .on("start", function () {
                                var currPos = d3.event.x;
                                console.log(currPos);
                            })
                            .on("drag", function () {
                                var currPos = d3.event.x;
                                currPos = Math.round(reverseXScale(currPos));
                                var leftPos = Math.round(reverseXScale(d3.select(".leftLine").attr("x")));
                                if(currPos !== Math.round(reverseXScale(d3.select(".rightLine").attr("x")))
                                    && currPos >= 2008 && currPos <= 2017
                                    && leftPos <= currPos)
                                {
                                    d3.selectAll(".rightLine").attr("x", xScale(currPos) - 5);
                                    d3.selectAll(".middleArea").attr("width", xScale(currPos) - xScale(leftPos));
                                    var selectedYears = [];
                                    for(var i = leftPos; i <= currPos; i++)
                                    {
                                        selectedYears.push(i.toString())
                                    }
                                    drawStates(selectedYears);
                                }
                            })
                        );

                    sizeChange();
                });
    });

    function sizeChange() {
        d3.selectAll(".scalable")
            .attr("transform", "scale(" + $("#mapSuicides").width()/901 + ")");

        $("#areaGraphs").children().height($("#mapSuicides").width()*0.28); //618
        $("#mapSuicides").height($("#mapSuicides").width()*0.7); //618
        $("#mapSuicidalThoughts").height($("#mapSuicidalThoughts").width()*0.7); //618

    }


</script>
</body>
</html>
